Bootstrap: localimage
From: sif/build/alpine-build.sif
Stage: build

%post
    version_major=1
    version_minor=13

    curl -Ls -o htslib.tar.bz2 "https://github.com/samtools/htslib/releases/download/${version_major}.${version_minor}/htslib-${version_major}.${version_minor}.tar.bz2"
    echo "f2407df9f97f0bb6b07656579e41a1ca5100464067b6b21bf962a2ea4b0efd65  htslib.tar.bz2" | sha256sum -c
    tar -xf htslib.tar.bz2

    apk --no-cache add -X http://dl-cdn.alpinelinux.org/alpine/edge/testing zlib-dev bzip2-dev xz-dev libdeflate-dev

    cd "htslib-${version_major}.${version_minor}"
    ./configure --disable-libcurl --disable-gcs --disable-s3
    make
    make install

Bootstrap: localimage
From: sif/build/alpine-scratch.sif
Stage: final

%files from build
    /usr/local/bin/bgzip
    /usr/local/bin/tabix

%post
    apk --no-cache add -X http://dl-cdn.alpinelinux.org/alpine/edge/testing zlib libbz2 xz-libs libdeflate

%help
    HTSlib is an implementation of a unified C library for accessing common file formats, such as SAM, CRAM and VCF. Includes the tabix indexer and the bgzip compression utility.
