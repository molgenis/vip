Bootstrap: localimage
From: sif/build/openjdk-17.sif

%help
    Genome Analysis Toolkit - Variant Discovery in High-Throughput Sequencing Data.
    Usage: java -jar /opt/gatk/lib/gatk.jar

%post
    version=4.2.5.0

    # install
    apk update
    # libc6-compat: resolve WARN NativeLibraryLoader
    apk add libgomp libc6-compat
    apk add --virtual=.build-dependencies curl

    mkdir -p /opt/gatk/lib
    curl -Ls -o gatk.zip "https://github.com/broadinstitute/gatk/releases/download/${version}/gatk-${version}.zip"
    echo "203f17868f0a73a8322d2f8bd568b9f7b4bb81e36d37db5b6a142d8050ef049f  gatk.zip" | sha256sum -c
    unzip -p gatk.zip "gatk-${version}/gatk-package-${version}-local.jar" > /opt/gatk/lib/gatk.jar

    # cleanup
    apk del .build-dependencies
    rm -rf /var/cache/apk/* gatk.zip
