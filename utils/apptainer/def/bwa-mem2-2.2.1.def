Bootstrap: localimage
From: sif/build/alpine-3.16.2.sif

%help
    BWA is a software package for mapping DNA sequences against a large reference genome
    Usage: bwa-mem2 index [-p prefix] <in.fasta>
    Usage: bwa-mem2 mem -t <num_threads> <prefix> <reads.fq/fa> > out.sam

%post
    version_major=2
    version_minor=2
    version_patch=1

    apk update
    apk add --virtual=.build-dependencies curl
    apk add build-base zlib-dev

    curl -Ls "https://github.com/bwa-mem2/bwa-mem2/releases/download/v${version_major}.${version_minor}.${version_patch}/Source_code_including_submodules.tar.gz" | tar xzf -
    # workaround for https://github.com/bwa-mem2/bwa-mem2/pull/205
    (cd bwa-mem2-"${version_major}"."${version_minor}"."${version_patch}"/src && curl -Ls -o utils.h https://raw.githubusercontent.com/bwa-mem2/bwa-mem2/d48e1dec3bc305124e0e2764a8824af29084dd66/src/utils.h)

    (cd bwa-mem2-"${version_major}"."${version_minor}"."${version_patch}" && make multi)

    # cleanup
    apk del .build-dependencies
    rm -rf /var/cache/apk/*