Bootstrap: localimage
From: sif/build/alpine-3.22.1.sif

%post
    version_major=2
    version_minor=1
    version_patch=3-patch1

    # install
    apk update
    apk add python3 py3-numpy py3-scikit-learn cython zlib libbz2 xz-libs libdeflate
    apk add --virtual=.build-dependencies curl build-base zlib-dev bzip2-dev xz-dev libdeflate-dev python3-dev py3-pip

    # --root-user-action=ignore: https://stackoverflow.com/a/72551258, suppresses build warning
    # Install Python packages (exact versions)
    pip install --root-user-action=ignore scipy==1.16.1 pysam==0.23.3 biopython==1.85 cigar==0.1.3 PyVCF3==1.0.4 --break-system-packages

    # -no-deps                 : fixes pyvcf install and pins dependency versions
    # --break-system-packages  : prevents "error: externally-managed-environment" exception
    # Install cuteSV from commit
    pip install --root-user-action=ignore --no-deps --break-system-packages \
      "git+https://github.com/tjiangHIT/cuteSV.git@441433d9e5a4e03be96afd796b313ba77159d421#egg=cuteSV"

    # cleanup
    pip cache purge
    apk del .build-dependencies
    rm -rf /var/cache/apk/*
%help
    Long-read-based human genomic structural variation detection.