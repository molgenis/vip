Bootstrap: localimage
From: sif/build/alpine-3.20.3.sif

%help
	Apptainer container running graalvm version 21 on Alpine Linux

%post
    # install
    apk update
    apk add gcc zlib zlib-dev libc-dev gcompat libstdc++
    apk add --virtual=.build-dependencies ca-certificates wget

    mkdir -p "/usr/lib/jvm"
    wget "https://github.com/graalvm/graalvm-ce-builds/releases/download/jdk-21.0.2/graalvm-community-jdk-21.0.2_linux-x64_bin.tar.gz"
    tar -xzf graalvm-community-jdk-21.0.2_linux-x64_bin.tar.gz -C /usr/lib/jvm
    rm -f graalvm-ce-21.0.2-linux-amd64.tar.gz

%environment
   JAVA_HOME=/usr/lib/jvm/graalvm-community-openjdk-21.0.2+13.1
   #workaround to solve "Unable to load jimage library"
   LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$JAVA_HOME/lib/server
   PATH=$PATH:/usr/lib/jvm/graalvm-community-openjdk-21.0.2+13.1/bin
